<html>
	<head>
        <meta charset="UTF-8">
		<link href="./styles/style.css" rel="stylesheet" type="text/css">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Panel de Usuario</title>
	</head>
	<body>
        <header id="cabecera">
            <a id="enlace_logo" href="index.php">
                <img id="logo" src="../img/logo.png" alt="logo">
            </a>
        </header>

        <div id="fila_principal" class="fila">
            <div id="panel_lateral_izquierdo" class="columna">
            </div>

			<div id="panel_principal" class="columna">
				<div class="fila_options">
					<div class="option" id="light-option">
						<img class="option_img" src="./img/idea.png" alt="lightbulb">
						<div id="light-info">
							<div><b>Luminosidad: </b><span id="luminosidad">Sin información</span></div>
							<div><b>Persiana: </b><span id="persiana">Bajada</span></div>
						</div>
						<button id="persiana_btn" class="option_btn" onclick="set_persiana()">Subir persiana</button>
					</div>
					<div class="option" id="tmp-option">
						<img class="option_img" src="./img/weather.png" alt="hot-cold">
						<div id="tmp-info">
							<div><b>Temperatura: </b><span id="temperatura">Sin información</span></div>
							<div><b>AC: </b><span id="ac">Apagado</span></div>
						</div>
						<button id="ac_btn" class="option_btn" onclick="set_ac()">Encender AC</button>
					</div>
				</div>
			</div>

            <div id="panel_lateral_derecho">
            </div>
        </div>

        <footer id="pie">
            <p id="pie_body">Made with love! By @Olasergiolas</p>
        </footer>
	</body>
	<script src="/socket.io/socket.io.js"></script>
	<script type="text/javascript">
		var estado = {persiana:false, ac:false};
		var serviceURL = document.URL;
		serviceURL = serviceURL.substring(0, serviceURL.lastIndexOf('/'));
		var socket = io.connect(serviceURL);

		socket.emit('obtener-estado', {});
		


		socket.on('emitir-estado', function(data){
			estado = data;
			document.getElementById("ac").innerHTML = estado.ac ? 'Encendido' : 'Apagado';
			document.getElementById("persiana").innerHTML = estado.persiana ? 'Subida' : 'Bajada';
			updateBotones();
		});

		socket.on('sensor-update', function(data){
			console.log(data);
			document.getElementById("luminosidad").innerHTML=data.luminosidad;
			document.getElementById("temperatura").innerHTML=data.temperatura;
		});

		socket.on('agent-msg', function(data){
			document.getElementById("agent-msg-container").innerHTML=data;
		});

		function set_ac(){
			estado.ac = !estado.ac;
			document.getElementById("ac").innerHTML = estado.ac ? 'Encendido' : 'Apagado';
			updateBotones();
			socket.emit('ac', estado.ac);
		}

		function set_persiana(){
			estado.persiana = !estado.persiana;
			document.getElementById("persiana").innerHTML = estado.persiana ? 'Subida' : 'Bajada';
			updateBotones();
			socket.emit('persiana', estado.persiana);
		}

		function updateBotones(){
			document.getElementById("ac_btn").innerHTML = estado.ac ? 'Apagar AC' : 'Encender AC';
			document.getElementById("persiana_btn").innerHTML = estado.persiana ? 'Bajar persiana' : 'Subir persiana';
		}
	</script>
</html>
